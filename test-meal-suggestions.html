<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meal Suggestions Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .test-container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 800px; margin: 0 auto; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button { padding: 12px 24px; margin: 10px 5px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        .save-btn { background: #28a745; color: white; }
        .suggest-btn { background: #007bff; color: white; }
        .test-btn { background: #6f42c1; color: white; }
        .clear-btn { background: #dc3545; color: white; }
        .ingredient-box { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 5px; }
        label { display: block; margin: 5px 0; cursor: pointer; }
        input[type="checkbox"] { margin-right: 8px; }
        .saved-list { min-height: 50px; padding: 15px; background: #f8f9fa; border-radius: 5px; border: 2px dashed #dee2e6; }
        .suggestions-area { min-height: 200px; padding: 15px; background: #f8f9fa; border-radius: 5px; border: 2px dashed #dee2e6; }
        .meal-card { background: white; padding: 15px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Meal Suggestions Test</h1>
        
        <div id="status" class="status info">
            Ready to test meal suggestions functionality...
        </div>
        
        <div class="ingredient-box">
            <h3>Test Ingredients:</h3>
            <label><input type="checkbox" id="chicken" data-ingredient="chicken"> üêî Chicken</label>
            <label><input type="checkbox" id="rice" data-ingredient="rice"> üçö Rice</label>
            <label><input type="checkbox" id="cheese" data-ingredient="cheese"> üßÄ Cheese</label>
            <label><input type="checkbox" id="garlic" data-ingredient="garlic"> üßÑ Garlic</label>
            <label><input type="checkbox" id="tomatoes" data-ingredient="tomatoes"> üçÖ Tomatoes</label>
            <label><input type="checkbox" id="shrimps" data-ingredient="shrimps"> ü¶ê Shrimps</label>
        </div>
        
        <div>
            <button id="saveBtn" class="save-btn">Save My Ingredients</button>
            <button id="suggestBtn" class="suggest-btn">Get Meal Suggestions</button>
            <button onclick="runTest()" class="test-btn">Run Auto Test</button>
            <button onclick="clearStorage()" class="clear-btn">Clear Storage</button>
        </div>
        
        <div class="ingredient-box">
            <h3>Saved Ingredients:</h3>
            <div id="savedIngredientsList" class="saved-list">
                <p>No ingredients saved yet.</p>
            </div>
        </div>
        
        <div class="ingredient-box">
            <h3>Meal Suggestions:</h3>
            <div id="mealSuggestions" class="suggestions-area">
                <p>Save your ingredients first, then click "Get Meal Suggestions" to see what you can cook.</p>
            </div>
        </div>
        
        <div class="ingredient-box">
            <h3>Console Output:</h3>
            <div id="console" style="background: #000; color: #0f0; padding: 10px; font-family: monospace; min-height: 100px; border-radius: 5px;">
                Console logs will appear here...
            </div>
        </div>
    </div>

    <script>
        // Override console.log to show in page
        const originalLog = console.log;
        const originalError = console.error;
        const consoleDiv = document.getElementById('console');
        
        function addToConsole(message, type = 'log') {
            const time = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#f00' : '#0f0';
            consoleDiv.innerHTML += `<div style="color: ${color};">[${time}] ${message}</div>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole(args.join(' '), 'error');
        };

        // Copy the exact functionality from your main script
        let saveButton;
        let savedIngredientsList;
        let suggestMealsButton;
        const STORAGE_KEY = 'dinnerHelperIngredients';

        // Mock RECIPE_DATABASE for testing
        const RECIPE_DATABASE = {
            "chicken-rice": {
                name: "Chicken and Rice",
                ingredients: ["chicken", "rice", "garlic", "onions"],
                difficulty: "Easy",
                time: "30 min",
                cuisine: "American",
                description: "Simple chicken and rice dish"
            },
            "cheese-pasta": {
                name: "Cheese Pasta",
                ingredients: ["pasta", "cheese", "garlic", "tomatoes"],
                difficulty: "Easy",
                time: "20 min",
                cuisine: "Italian",
                description: "Creamy cheese pasta"
            },
            "shrimp-fried-rice": {
                name: "Shrimp Fried Rice",
                ingredients: ["shrimps", "rice", "garlic", "eggs"],
                difficulty: "Medium",
                time: "25 min",
                cuisine: "Chinese",
                description: "Classic fried rice with shrimp"
            }
        };

        document.addEventListener('DOMContentLoaded', function() {
            saveButton = document.getElementById('saveBtn');
            savedIngredientsList = document.getElementById('savedIngredientsList');
            suggestMealsButton = document.getElementById('suggestBtn');
            
            loadSavedIngredients();
            setupEventListeners();
            
            updateStatus('‚úÖ App initialized successfully!', 'success');
        });

        function setupEventListeners() {
            console.log('Setting up event listeners...');
            
            if (saveButton) {
                saveButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Save button clicked!');
                    saveIngredients();
                });
            }
            
            if (suggestMealsButton) {
                suggestMealsButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Suggest meals button clicked!');
                    suggestMeals();
                });
            }
        }

        function loadSavedIngredients() {
            try {
                const savedIngredients = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
                
                const allCheckboxes = document.querySelectorAll('input[type="checkbox"]');
                allCheckboxes.forEach(checkbox => {
                    const ingredient = checkbox.getAttribute('data-ingredient');
                    if (savedIngredients.includes(ingredient)) {
                        checkbox.checked = true;
                    }
                });
                
                displaySavedIngredients(savedIngredients);
            } catch (error) {
                console.error('Error loading saved ingredients:', error);
                displaySavedIngredients([]);
            }
        }

        function saveIngredients() {
            console.log('Save ingredients function called!');
            const checkedIngredients = [];
            
            const allCheckboxes = document.querySelectorAll('input[type="checkbox"]');
            console.log('Found checkboxes:', allCheckboxes.length);
            
            allCheckboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    const ingredient = checkbox.getAttribute('data-ingredient');
                    checkedIngredients.push(ingredient);
                }
            });
            
            console.log('Checked ingredients found:', checkedIngredients);
            
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(checkedIngredients));
                displaySavedIngredients(checkedIngredients);
                showSuccessMessage();
                updateStatus(`‚úÖ Successfully saved ${checkedIngredients.length} ingredients!`, 'success');
            } catch (error) {
                console.error('Error saving ingredients:', error);
                showErrorMessage();
                updateStatus('‚ùå Error saving ingredients: ' + error.message, 'error');
            }
        }

        function displaySavedIngredients(ingredients) {
            const listContainer = savedIngredientsList;
            
            if (ingredients.length === 0) {
                listContainer.innerHTML = '<p style="color: #666; font-style: italic;">No ingredients saved yet.</p>';
                return;
            }
            
            const ingredientItems = ingredients.map(ingredient => {
                const displayName = ingredient.charAt(0).toUpperCase() + ingredient.slice(1).replace('-', ' ');
                return `<span style="display: inline-block; background: #e7f3ff; padding: 5px 10px; margin: 2px; border-radius: 15px; border-left: 3px solid #007bff;">${displayName}</span>`;
            }).join('');
            
            listContainer.innerHTML = ingredientItems;
        }

        function showSuccessMessage() {
            const originalText = saveButton.textContent;
            saveButton.textContent = 'Saved! ‚úì';
            saveButton.style.background = '#28a745';
            
            setTimeout(() => {
                saveButton.textContent = originalText;
                saveButton.style.background = '#28a745';
            }, 2000);
        }

        function showErrorMessage(message = 'Error! Try again') {
            const originalText = saveButton.textContent;
            saveButton.textContent = message;
            saveButton.style.background = '#dc3545';
            
            setTimeout(() => {
                saveButton.textContent = originalText;
                saveButton.style.background = '#28a745';
            }, 3000);
        }

        function showNoIngredientsMessage() {
            const suggestionsContainer = document.getElementById('mealSuggestions');
            if (suggestionsContainer) {
                suggestionsContainer.innerHTML = `
                    <div class="no-ingredients-message" style="text-align: center; color: #6c757d; padding: 20px;">
                        <h3>Save your ingredients first!</h3>
                        <p>Select the ingredients you have and click "Save My Ingredients" to get meal suggestions.</p>
                    </div>
                `;
            }
        }

        function findMatchingMeals(availableIngredients) {
            console.log('Finding matching meals for:', availableIngredients);
            const suggestions = [];
            
            Object.keys(RECIPE_DATABASE).forEach(recipeId => {
                const recipe = RECIPE_DATABASE[recipeId];
                const matchingIngredients = recipe.ingredients.filter(ingredient => 
                    availableIngredients.includes(ingredient)
                );
                
                const matchPercentage = (matchingIngredients.length / recipe.ingredients.length) * 100;
                console.log(`Recipe ${recipe.name}: ${matchingIngredients.length}/${recipe.ingredients.length} ingredients match (${matchPercentage.toFixed(1)}%)`);
                
                if (matchPercentage >= 50) {
                    suggestions.push({
                        id: recipeId,
                        ...recipe,
                        matchPercentage: Math.round(matchPercentage),
                        missingIngredients: recipe.ingredients.filter(ingredient => 
                            !availableIngredients.includes(ingredient)
                        )
                    });
                }
            });
            
            suggestions.sort((a, b) => b.matchPercentage - a.matchPercentage);
            console.log('Found suggestions:', suggestions.length);
            return suggestions;
        }

        function displaySuggestedMeals(meals) {
            const suggestionsContainer = document.getElementById('mealSuggestions');
            
            if (meals.length === 0) {
                suggestionsContainer.innerHTML = `
                    <div class="no-suggestions" style="text-align: center; color: #6c757d; padding: 20px;">
                        <h3>No meal suggestions available</h3>
                        <p>Try selecting more ingredients or different combinations.</p>
                    </div>
                `;
                return;
            }
            
            const mealCards = meals.map(meal => `
                <div class="meal-card">
                    <h4>${meal.name}</h4>
                    <p><strong>Match:</strong> ${meal.matchPercentage}%</p>
                    <p><strong>Cuisine:</strong> ${meal.cuisine}</p>
                    <p><strong>Difficulty:</strong> ${meal.difficulty}</p>
                    <p><strong>Time:</strong> ${meal.time}</p>
                    <p>${meal.description}</p>
                    ${meal.missingIngredients.length > 0 ? 
                        `<p><strong>Missing:</strong> ${meal.missingIngredients.join(', ')}</p>` : 
                        '<p><strong>‚úÖ You have all ingredients!</strong></p>'
                    }
                </div>
            `).join('');
            
            suggestionsContainer.innerHTML = mealCards;
        }

        async function suggestMeals() {
            console.log('suggestMeals function called!');
            const savedIngredients = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
            console.log('Saved ingredients:', savedIngredients);
            
            if (savedIngredients.length === 0) {
                console.log('No ingredients saved, showing message');
                showNoIngredientsMessage();
                return;
            }
            
            const suggestionsContainer = document.getElementById('mealSuggestions');
            suggestionsContainer.innerHTML = `
                <div class="loading-message" style="text-align: center; color: #007bff; padding: 20px;">
                    <h3>Finding recipes for you...</h3>
                    <p>Searching through recipes with matching ingredients!</p>
                </div>
            `;
            
            try {
                console.log('Finding matching meals...');
                const suggestedMeals = findMatchingMeals(savedIngredients);
                console.log('Suggested meals:', suggestedMeals);
                
                displaySuggestedMeals(suggestedMeals);
                updateStatus(`‚úÖ Found ${suggestedMeals.length} meal suggestions!`, 'success');
            } catch (error) {
                console.error('Error in suggestMeals:', error);
                showErrorMessage('Unable to fetch recipes right now. Please try again later.');
                updateStatus('‚ùå Error getting meal suggestions: ' + error.message, 'error');
            }
        }

        function updateStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }

        function runTest() {
            updateStatus('üß™ Running automated meal suggestion test...', 'info');
            
            // Clear all checkboxes first
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            
            // Select some ingredients
            document.getElementById('chicken').checked = true;
            document.getElementById('rice').checked = true;
            document.getElementById('garlic').checked = true;
            
            console.log('Auto-test: Selected chicken, rice, and garlic');
            
            // Save ingredients
            setTimeout(() => {
                saveIngredients();
                
                // Test meal suggestions
                setTimeout(() => {
                    suggestMeals();
                    
                    // Verify the suggestions worked
                    setTimeout(() => {
                        const suggestionsDiv = document.getElementById('mealSuggestions');
                        if (suggestionsDiv.innerHTML.includes('meal-card')) {
                            updateStatus('üéâ Auto-test PASSED! Meal suggestions work correctly.', 'success');
                            console.log('Auto-test: SUCCESS - Meal suggestions working');
                        } else {
                            updateStatus('‚ùå Auto-test FAILED! No meal suggestions found.', 'error');
                            console.error('Auto-test: FAILED - No meal suggestions displayed');
                        }
                    }, 1000);
                }, 500);
            }, 500);
        }
        
        function clearStorage() {
            localStorage.removeItem(STORAGE_KEY);
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            displaySavedIngredients([]);
            document.getElementById('mealSuggestions').innerHTML = '<p>Save your ingredients first, then click "Get Meal Suggestions" to see what you can cook.</p>';
            updateStatus('üóëÔ∏è Storage cleared and checkboxes reset.', 'info');
            console.log('Storage cleared');
        }
    </script>
</body>
</html>
